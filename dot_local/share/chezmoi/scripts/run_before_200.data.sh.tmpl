#!/usr/bin/env bash

{{- $data := false -}}
{{- if eq .opts.mode "personal" -}}
{{-     $data = (joinPath .chezmoi.sourceDir ".personal_data.yaml.age" | include | decrypt | fromYaml) -}}
{{- else if eq .opts.mode "work" -}}
{{-     $data = (joinPath .chezmoi.sourceDir ".work_data.yaml.age" | include | decrypt | fromYaml) -}}
{{- end -}}

cat << EOF > {{ .chezmoi.sourceDir }}/.chezmoidata.yml
git:
    user: {{ $data.git.user }}
    email: {{ $data.git.email }}
secrets:
    deeplApiKey: {{ $data.secrets.deeplApiKey }}
EOF